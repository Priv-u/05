# Установка веб-приложения на сервер  (Python-Flask-Gunicorn-Nginx)
Использование современных фреймворков таких как **[Flask](https://flask.palletsprojects.com/en/2.2.x/)** или **[Django](https://www.djangoproject.com/)** позволяют достаточно просто организовать разработку веб-приложения на языке **[Python](https://www.python.org/)**, используя при этом для тестирования локальные серверы. Такого рода программные серверы, как правило устанавливаются при установке самих фреймворков и их использование не вызывает ни каких затруднений. Однако использование данных серверов для разворачивании приложения не допустимо, т.к. не позволяет обеспечить достаточный уровень безопасности приложения при его использовании. 

В данной ситуации потребуется развертывание приложения на web сервере. В качестве такого сервера может быть использован как собственный сервер вашей компании или ваш домашний сервер, как и виртуальный или облачный сервер. Главным условием выбора сервера является наличие у него статического IP адреса.

В данной публикации будет рассмотрен вариант развертывания web приложения на виртуальной машине с установленной операционной системой **`Linux Debian 11`** с применением серверов **[Gunicorn](https://gunicorn.org/)** и **[Nginx](https://nginx.org/ru/)**


Полный порядок подключения можно найти **[здесь](https://www.digitalocean.com/community/tutorials/how-to-serve-flask-applications-with-gunicorn-and-nginx-on-ubuntu-18-04)**

---------
### Заголовок третьего уровня
#### Заголовок четвертого уровня
##### Заголовок пятого уровня
## Базовая установка и настройка веб-сервера
  Перед началом разработки приложения (если разработку планируется вести прямо на сервере) или публикации на сервере уже написанного приложения требуется выполнить некоторые подготовительные действия. 
## 1. Создаем инфраструктуру папок, в которых будут находиться все файлы нашего приложения.
 В нашем случае будет всего одна корневая директория, размещаемая в одной из директорий созданных в корне жесткого диска. 
```bash
  $ sudo mkdir /path/to/folder/my_site
```
## 2. Изменение владельца папки и прав доступа к ней
```bash
  $ sudo chown user:group /path/to/folder/my_site
```
## 3. Создание виртуального окружения. 
Виртуальное окружение в Python — способ изолировать зависимости (пакеты) для определённого проекта.
Создаётся через модуль `venv`, который идёт в поставке `Python 3`.

Используется команда **`python −m venv`** и название директории, в которой будет создано виртуальное окружение.
```bash
  cd /path/to/folder/my_site
  python3 -m venv venv
```
Флаг `-m` указывает Python-у запустить **`venv`** как исполняемый модуль.
**`venv/`** — название виртуального окружения (где будут храниться ваши библиотеки).

В результате будет создан каталог **`venv/`** содержащий копию интерпретатора Python, стандартную библиотеку и другие вспомогательные файлы.
## 4. Активация виртуального окружения 
  ```bash
    $ source /venv/bin/activate
  ```
## 5. Установка зависимостей
Для обеспечения процесса разработки веб-приложения установим следующие программные пакеты - **`flask, gunicorn, wheel, sqlite3 libsqlite3-dev`**. Установку сервера **`Nginx`** выполним чуть позднее.


Два последних будут использоваться для обеспечения работы из консоли с базой данных **`sqlite3`** в интерактивном режиме при отсутствии графической оболочки на сервере. Т.е. позволят пр необходимости вносить изменения в используемую базу данных.
  ```bash
    (venv)$ pip install flask gunicorn wheel sqlite3 libsqlite3-dev
  ```
> Собственно далее должен выполняться процесс разработки приложения или размещения уже готового приложения в созданной нами директории. Данный процесс по понятным причинам опустим и перейдем сразу к настройке WSGI севера приложений 
## 6. Создаем точку входа в приложение для `gunicorn`
  ```bash
    (venv)$  nano /opt/my_project/wsgi.py
  ```
  В созданный файл записываем следующий код:
  ```python
    from app import app

    if __name__ == "__main__":
        app.run()
  ```
## 7. Первый запуск `gunicorn` 
> В нашем проекте мы будем использовать привязку к ip `0.0.0.0` и порту `8080`
  ```bash
  (venv)$ gunicorn --bind 0.0.0.0:8080 wsgi:app
  ```
>Если все было выполнено правильно, то можно будет увидеть подобный вывод на экране терминала:
```bash
    [2021-11-19 23:07:57 +0000] [8760] [INFO] Starting gunicorn 20.1.0
    [2021-11-19 23:07:57 +0000] [8760] [INFO] Listening at: http://0.0.0.0:5000 (8760)
    [2021-11-19 23:07:57 +0000] [8760] [INFO] Using worker: sync
    [2021-11-19 23:07:57 +0000] [8763] [INFO] Booting worker with pid: 8763
```
Останавливаем `gunicorn`  нажав <kbd>Ctrl</kbd> + <kbd>C</kbd> и создаем для него службу
## 8. Создание службы 
>Для постоянной работы сервер wsgi будет запускаться и работать на уровне службы
  ```bash
  $ sudo nano /etc/systemd/system/my_site.service
  ```
## 9. Запуск службы
  ```bash
  $ sudo systemctl start my_site
  ```

## 10. Конфигурирование Gunicorn
```bash

```

## 10. Создание и запуск демона
  ```bash
  $ sudo systemctl enable my_site
  ```

<details>
    <summary>Продолжение</summary>
    В следующем подкасте будет детально рассмотрена установка и настройка сервера <b>Nginx</b> для работы в качестве прокси-сервера для Gunicorn
</details>


## 11. Установка сервера `Nginx`

## 12. Настройка проксирования `Nginx-Gunicorn`


>## Эти ролики будут разделены <bdo>между</bdo> собой строчкой в которую можно вставить цитату или комментарий.

<div align="center" style="margin: 50px">
<iframe width="800" height="600" src="https://www.youtube.com/embed/DojzT2P3ObU" title="Встречайте новый российский атомный суперавианосец, получивший название проекта 23000Э-Шторм" frameborder="5" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
</div>
